# Content Core main configuration
# Copy this file to your project root or set CCORE_CONFIG_PATH to its location

speech_to_text:
  provider: openai
  model_name: gpt-4o-transcribe-diarize
  timeout: 3600  # 1 hour - for processing very long audio files

default_model:
  provider: openai
  model_name: gpt-4o-mini
  config:
    temperature: 0.5
    top_p: 1
    max_tokens: 2000
    timeout: 300  # 5 minutes - for general language model operations

cleanup_model:
  provider: openai
  model_name: gpt-4o-mini
  config:
    temperature: 0
    max_tokens: 8000
    output_format: json
    timeout: 600  # 10 minutes - for complex content cleaning with large inputs

summary_model:
  provider: openai
  model_name: gpt-4o-mini
  config:
    temperature: 0
    top_p: 1
    max_tokens: 2000
    timeout: 300  # 5 minutes - for content summarization

extraction:
  # Global extraction timeout in seconds
  timeout: 300

  # Legacy engine config (v1.x compatibility)
  # These are used as fallback when no engines config matches
  document_engine: auto  # auto | simple | docling - for files/documents
  url_engine: auto  # auto | simple | firecrawl | jina | crawl4ai | docling - for URLs

  # Engine configuration by MIME type or category (v2.0)
  # Keys can be:
  #   - Specific MIME types: "application/pdf", "image/png"
  #   - Wildcard MIME types: "image/*", "audio/*"
  #   - Categories: "documents", "urls", "audio", "video"
  # Values can be a single engine name or list (fallback chain)
  # Environment variables override: CCORE_ENGINE_<KEY> (e.g., CCORE_ENGINE_APPLICATION_PDF)
  engines: {}
  # Example configuration:
  # engines:
  #   "application/pdf":
  #     - docling-vlm
  #     - docling
  #     - pymupdf
  #   "image/*": docling
  #   documents: docling
  #   urls: jina

  # Fallback behavior when extraction fails
  # Environment variables: CCORE_FALLBACK_ENABLED, CCORE_FALLBACK_MAX_ATTEMPTS, CCORE_FALLBACK_ON_ERROR
  fallback:
    enabled: true           # Enable fallback to next engine on failure
    max_attempts: 3         # Maximum number of engines to try
    on_error: warn          # How to handle errors: next | warn | fail
    fatal_errors:           # Errors that should not trigger fallback
      - FileNotFoundError
      - PermissionError
      - ValidationError
      - FatalExtractionError

  # Engine-specific options (merged with processor options)
  engine_options: {}
  # Example:
  # engine_options:
  #   docling:
  #     do_ocr: true
  #   docling-vlm:
  #     backend: mlx

  audio:
    concurrency: 3              # Number of concurrent audio transcriptions (1-10)
  firecrawl:
    api_url: null  # Custom API URL for self-hosted Firecrawl (e.g., "http://localhost:3002")
                   # Environment variable FIRECRAWL_API_BASE_URL takes precedence
  docling:
    output_format: markdown  # markdown | html | json
    # Processing options for both standard docling and VLM extraction
    # These options apply to PDF processing and can be overridden via environment variables
    options:
      # OCR settings - enabled by default for scanned PDFs
      do_ocr: true
      ocr_engine: easyocr          # easyocr | tesseract | tesserocr | rapidocr | ocrmac
      force_full_page_ocr: false   # Only OCR where necessary (not full page)
      # Table settings - accurate mode by default for better quality
      table_mode: accurate         # accurate | fast
      do_table_structure: true     # Preserve table structure
      # Enrichment settings - formula enabled for scientific papers
      do_code_enrichment: false    # Code block enrichment (rarely needed)
      do_formula_enrichment: true  # LaTeX formula enrichment (useful for papers)
      # Image/picture settings - minimal by default (smaller output)
      generate_page_images: false
      generate_picture_images: false
      images_scale: 2.0  # Higher resolution for better VLM processing
      do_picture_classification: false
      do_picture_description: false  # Requires VLM, computationally expensive
      # Picture description settings (only used when do_picture_description: true)
      # Note: Forces CPU device due to MPS compatibility issues with SmolVLM/Granite Vision
      picture_description_model: granite  # smolvlm (256M, faster) | granite (2B, better quality)
      picture_description_prompt: "Describe this image in detail. Include the type of visualization, axes labels, data trends, and any text visible in the image."
      # Timeout - no limit by default
      document_timeout: null
    vlm:
      inference_mode: local      # local | remote
      local:
        backend: auto            # auto | transformers | mlx
        model: granite-docling   # granite-docling | smol-docling
      remote:
        url: http://localhost:5001
        api_key: null
        timeout: 120
  pymupdf:
    enable_formula_ocr: false    # Enable OCR for formula-heavy pages (requires Tesseract)
    formula_threshold: 3         # Minimum formulas per page to trigger OCR
    ocr_fallback: true          # Gracefully fallback to standard extraction if OCR fails

youtube_transcripts:
  preferred_languages: ["en", "es", "pt"]

# Retry configuration for transient failures
# Each operation type can be configured independently
# Environment variables override these settings (e.g., CCORE_YOUTUBE_MAX_RETRIES)
retry:
  youtube:
    max_attempts: 5       # Number of retry attempts (YouTube has aggressive rate limiting)
    base_delay: 2         # Base delay in seconds for exponential backoff
    max_delay: 60         # Maximum delay between retries
  url_api:
    max_attempts: 3       # For API-based URL extraction (Jina, Firecrawl) and Crawl4AI
    base_delay: 1
    max_delay: 30
  url_network:
    max_attempts: 3       # For network-only operations (BeautifulSoup, HEAD requests)
    base_delay: 0.5
    max_delay: 10
  audio:
    max_attempts: 3       # For speech-to-text API calls
    base_delay: 2
    max_delay: 30
  llm:
    max_attempts: 3       # For LLM API calls (summary, cleanup)
    base_delay: 1
    max_delay: 30
  download:
    max_attempts: 3       # For remote file downloads
    base_delay: 1
    max_delay: 15
